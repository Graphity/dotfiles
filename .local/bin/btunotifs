#!/usr/bin/env python3

import json
import requests
import notify
from bs4 import BeautifulSoup

url = 'https://classroom.btu.edu.ge/ge/login/trylogin'

with open('/home/graphity/.local/bin/.cfg/btu.json', 'r') as f:
    data = json.load(f)


def check_inbox():
    r = requests.post(url, data={'username': data['user'], 'password': data['pass']})
    soup = BeautifulSoup(r.content, 'html.parser')
    msgs = soup.find('a', {'title': 'შეტყობინებები'}).text.strip()
    return f'{msgs} unread messages'


if __name__ == '__main__':
    try:
        info = check_inbox()
        indicator = info.split()[0]
    except:
        info = 'Error occurred'
        indicator = 'X'
    finally:
        notify.send_notif('BTU', 'BTU Classroom', info)
        print(indicator)
