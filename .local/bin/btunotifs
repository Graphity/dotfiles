#!/usr/bin/env python3

import json
import requests
import notify

with open('/home/graphity/.local/bin/.cfg/btu.json', 'r') as f:
    data = json.load(f)


def get_inbox(url):
    return requests.get(url, headers={'Authorization': data['cookie']}).json()['inbox']


notif_count = get_inbox('https://newclassroom.btu.ge/student/notification/getUnreadNotificationCount')
msg_count = get_inbox('https://newclassroom.btu.ge/student/message/count')
info = f'{msg_count} unread messages and {notif_count} notifications'


if __name__ == '__main__':
    notify.send_notif('BTU', 'BTU Classroom', info)
    if msg_count == 0 and notif_count == 0:
        print(0)
    else:
        print(f'{msg_count}({notif_count})')
